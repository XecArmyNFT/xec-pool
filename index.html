<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>XEC Pool â€“ 8 Ball Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.js"></script>
<style>
html,body{margin:0;padding:0;background:#000}
#game{width:100vw;height:100vh}
</style>
</head>

<body>
<div id="game"></div>

<script>
const config = {
  type: Phaser.WEBGL,
  parent: 'game',
  width: 1280,
  height: 720,
  backgroundColor: '#0b3d2e',
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 0 },
      debug: false
    }
  },
  scene: { preload, create, update }
};

const game = new Phaser.Game(config);

let cueBall;
let balls = [];
let pockets = [];
let aiming = false;
let aimLine;
let power = 0;
let powerBar;
let turnText;
let currentPlayer = 1;

function preload() {
  this.load.image('ball','https://i.imgur.com/2RXYyqk.png');
}

function create() {
  // UI
  turnText = this.add.text(20,20,'Player 1 Turn',{font:'20px Arial',fill:'#fff'});
  powerBar = this.add.rectangle(640,680,0,12,0xff0000);

  // Cue ball
  cueBall = this.physics.add.image(350,360,'ball');
  cueBall.setCircle(16);
  cueBall.setDamping(true);
  cueBall.setDrag(0.985);
  cueBall.setMaxVelocity(900);
  balls.push(cueBall);

  // Rack
  for(let i=0;i<6;i++){
    const b = this.physics.add.image(850+i*34,360,'ball');
    b.setCircle(16);
    b.setDamping(true);
    b.setDrag(0.985);
    balls.push(b);
  }

  balls.forEach(b=>b.setCollideWorldBounds(true,1,1));
  this.physics.add.collider(balls,balls);

  // Pockets
  const pocketPos=[
    [40,40],[640,30],[1240,40],
    [40,680],[640,690],[1240,680]
  ];
  pocketPos.forEach(p=>{
    const pocket=this.add.circle(p[0],p[1],28,0x000000);
    this.physics.add.existing(pocket,true);
    pockets.push(pocket);
  });

  pockets.forEach(p=>{
    balls.forEach(b=>{
      this.physics.add.overlap(b,p,()=>sinkBall(b));
    });
  });

  aimLine=this.add.graphics();

  this.input.on('pointerdown',p=>{
    if(cueBall.body.speed<5){
      aiming=true;
      power=0;
    }
  });

  this.input.on('pointerup',p=>{
    if(!aiming) return;
    aiming=false;
    aimLine.clear();
    const dx=cueBall.x-p.x;
    const dy=cueBall.y-p.y;
    cueBall.setVelocity(dx*power*0.06,dy*power*0.06);
    powerBar.width=0;
  });
}

function update() {
  aimLine.clear();

  if(aiming){
    power=Math.min(power+1.5,100);
    powerBar.width=power*4;

    const p=this.input.activePointer;
    aimLine.lineStyle(2,0xffffff);
    aimLine.beginPath();
    aimLine.moveTo(cueBall.x,cueBall.y);
    aimLine.lineTo(p.x,p.y);
    aimLine.strokePath();
  }

  if(allStopped()){
    turnText.setText(`Player ${currentPlayer} Turn`);
  }
}

function sinkBall(ball){
  if(ball===cueBall){
    cueBall.setPosition(350,360);
    cueBall.setVelocity(0);
    switchTurn();
    return;
  }
  ball.disableBody(true,true);
  balls=balls.filter(b=>b.active);
  switchTurn();
}

function allStopped(){
  return balls.every(b=>b.body.speed<3);
}

function switchTurn(){
  currentPlayer=currentPlayer===1?2:1;
}
</script>
</body>
</html>
